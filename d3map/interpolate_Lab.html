<!DOCTYPE html>
<meta charset="utf-8">
<style>

.states {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
}

</style>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
<script type="text/javascript" src="https://raw.githubusercontent.com/mbostock/d3/master/lib/colorbrewer/colorbrewer.js"></script>

<script>



    var width = 960,
        height = 500;

    var color = d3.scale.log()
        .range(["hsl(62,100%,90%)", "hsl(228,30%,20%)"])
        .interpolate(d3.interpolateHcl);

    var path = d3.geo.path()
        .projection(null);

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

d3.json("us.json", function(error, us) {

    var densities = counties
        .map(function(d) { return d.properties.density = d.properties.pop / path.area(d); })
        .sort(function(a, b) { return a - b; });

    color.domain([d3.quantile(densities, .01), d3.quantile(densities, .99)]);

    svg.append("g")
        .attr("class", "counties")
      .selectAll("path")
        .data(counties)
      .enter().append("path")
        .style("fill", function(d) { return color(d.properties.density); })
        .attr("d", path);
  });

</script>
